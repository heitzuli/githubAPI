<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="tabs.css">
    <meta charset="UTF-8">
    <title>Awesome smileys</title>
</head>
<body>
    <div class="center">
        <!-- Tab links -->
        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'Events')" id="defaultOpen">Events</button>
            <button class="tablinks" onclick="openTab(event, 'Emojis')">Emojis</button>
        </div>

        <!-- Tab content -->
        <div id="Emojis" class="tabcontent">
            <h3>Search an emoji</h3>
            <p>
                Hi there! <br>
                Welcome to my first ever, completed, project done using HTML, CSS and JavaScript. <br>
                In the search field below you can search for emojies used on the GitHub page. <br>
                Go on, try it!
            </p>
            <h3 id="header">Search here </h3>
            <div class="autocomplete" style="width:300px;">
                <input type="text" id="search" value="loading..." onkeyup="search()">
            </div>

            <div id="emoji"></div>
        </div>

        <div id="Events" class="tabcontent">
            <h3>List user events</h3>
            <p>Explain how</p>
            <label for="username">Github username</label><input type="text" id="username"/>
            <button onclick="loadEvents()">Load events</button>

            <div id="gitHubEvents"></div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="search.js"></script>
    <script src="tabs.js"></script>
    <script src="autocomplete.js"></script>
    <script>
        // clicks on the default tab so it will be shown (see tabs.js)
        document.getElementById("defaultOpen").click();

        (async () => {
            const searchField = document.getElementById('search');
            smileys = await getJSON(config.baseURL + '/emojis');
            autocomplete(document.getElementById('search'), Object.keys(smileys));
            searchField.disabled = false;
            searchField.value = '';
        })();

        createRepoHTML = (repo) => `<a href="${config.gitHubURL}/${repo.name}">${repo.name}</a>`;

        // event.type = PushEvent
        createPushEventHTML = (gitHubEvent) => `Pushed to ${createRepoHTML(gitHubEvent.repo)}`;

        // event.type = CreateEvent
        createCreateEventHTML = (gitHubEvent) => `Created a ${gitHubEvent.payload.ref_type}`;

        // All other types
        createGenericEventHTML = (gitHubEvent) => `${gitHubEvent.type}`

        createSpecificEventHTML = (gitHubEvent) => {
            switch (gitHubEvent.type) {
                case 'PushEvent': return createPushEventHTML(gitHubEvent);
                case 'CreateEvent': return createCreateEventHTML(gitHubEvent);
                default: return createGenericEventHTML(gitHubEvent);
            }
        }

        createEventHTML = (gitHubEvent) => `<div>${gitHubEvent.created_at}: ${createSpecificEventHTML(gitHubEvent)}</div>`

        createErrorHTML = (message) => `<div class="error">Could not load events: ${message}</div>`

        loadEvents = async() => {
            const gitHubUserName = document.getElementById('username').value;
            const gitHubEventsField = document.getElementById('gitHubEvents');

            // get list from github
            const events = await getJSON(`${config.baseURL}/users/${gitHubUserName}/events`);
            if (events.message) {
                // handle error somehow if there is one. Let's only handle 404 for now.
                gitHubEventsField.innerHTML = createErrorHTML(events.message);
            } else {

            // otherwise show list
            gitHubEventsField.innerHTML = events
                .map(event => createEventHTML(event))
                .join(''); // not joining will use a comma as separator
            }
        }
    </script>

</body>
</html>